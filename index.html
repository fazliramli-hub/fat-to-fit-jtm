<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fat to Fit JTM - Basic</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome for Icons (v6.4.0) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .jtm-blue {
            background-color: #1e3a8a;
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Animasi tersuai untuk keputusan */
        .icon-pop {
            animation: pop 0.5s cubic-bezier(0.26, 0.53, 0.74, 1.48) forwards;
        }

        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="text-gray-800 min-h-screen flex items-center justify-center p-4">

    <!-- Chosen Palette: JTM Blue & Friendly Neutrals -->
    <!-- Application Structure Plan:
         - Halaman Log Masuk: Pengenalan ringkas pegawai.
         - Halaman Utama: Gabungan borang timbangan dan kandungan pendidikan.
         - Interaksi: Kiraan BMI dinamik dengan ikon animasi lucu.
         - Akses Admin: Kebolehlihatan pautan data berdasarkan nama pengguna.
    -->
    <!-- Visualization & Content Choices:
         - Kurang Berat: fa-shrimp (Ikon udang yang lucu)
         - Normal: fa-face-grin-stars (Ikon mantap)
         - Berat Berlebihan: fa-cookie-bite (Ikon sikit lagi)
         - Obesiti: fa-face-dizzy (Ikon alamak)
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <!-- 1. HALAMAN: LOG MASUK -->
    <div id="loginPage" class="w-full max-w-md bg-white rounded-2xl shadow-xl p-8 animate-fade-in">
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-blue-100 mb-4 text-blue-800">
                <i class="fa-solid fa-user-circle text-4xl"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-800">Log Masuk Pegawai</h2>
            <p class="text-sm text-gray-500 mt-2">Sila kenal pasti diri anda untuk memulakan timbangan.</p>
        </div>
        
        <form id="loginForm" class="space-y-5">
            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Nama Penuh</label>
                <input type="text" id="loginName" required placeholder="Cth: Ahmad bin Abu" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-600 outline-none transition-all">
                <p class="text-[10px] text-gray-400 mt-1">* Log masuk sebagai 'Admin' untuk akses data keseluruhan.</p>
            </div>
            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Bahagian</label>
                <select id="loginDept" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-600 outline-none bg-white transition-all">
                    <option value="">Pilih Bahagian...</option>
                    <option value="PENGURUSAN TERTINGGI">PENGURUSAN TERTINGGI</option>
                    <option value="BAHAGIAN KHIDMAT PENGURUSAN">BAHAGIAN KHIDMAT PENGURUSAN</option>
                    <option value="BAHAGIAN PEMBANGUNAN KEMAHIRAN">BAHAGIAN PEMBANGUNAN KEMAHIRAN</option>
                    <option value="BAHAGIAN KAWALAN TEKNIKAL">BAHAGIAN KAWALAN TEKNIKAL</option>
                    <option value="BAHAGIAN PENGURUSAN LATIHAN">BAHAGIAN PENGURUSAN LATIHAN</option>
                    <option value="BAHAGIAN PERANCANGAN & PENYELIDIKAN">BAHAGIAN PERANCANGAN & PENYELIDIKAN</option>
                    <option value="UNIT JALINAN INDUSTRI">UNIT JALINAN INDUSTRI</option>
                </select>
            </div>
            <button type="submit" class="w-full jtm-blue hover:bg-blue-800 text-white font-bold py-3 rounded-lg shadow-lg transform active:scale-95 transition-all">
                Masuk <i class="fa-solid fa-arrow-right ml-2"></i>
            </button>
        </form>
    </div>

    <!-- 2. HALAMAN: TIMBANGAN & HANTAR -->
    <div id="mainPage" class="hidden w-full max-w-lg bg-white rounded-2xl shadow-xl overflow-hidden animate-fade-in my-8">
        <!-- Kepala Halaman -->
        <div class="jtm-blue p-6 text-white flex justify-between items-center">
            <div>
                <h1 class="font-bold text-xl">Fat to Fit JTM</h1>
                <p id="userInfo" class="text-xs text-blue-200">Nama Pegawai | Bahagian</p>
            </div>
            <button onclick="logout()" class="text-white opacity-70 hover:opacity-100">
                <i class="fa-solid fa-power-off text-lg"></i>
            </button>
        </div>

        <!-- Borang Timbangan -->
        <div class="p-8">
            <form id="timbanganForm" class="space-y-6">
                <div class="grid grid-cols-2 gap-4">
                    <div class="col-span-2">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Tarikh</label>
                        <input type="date" id="inputDate" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-600 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Berat (kg)</label>
                        <input type="number" id="inputWeight" step="0.1" placeholder="0.0" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-600 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Tinggi (cm)</label>
                        <input type="number" id="inputHeight" step="1" placeholder="0" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-600 outline-none">
                    </div>
                </div>

                <!-- Kawasan Keputusan dengan Ikon Animasi -->
                <div id="resultBox" class="hidden p-6 bg-blue-50 border border-blue-100 rounded-xl">
                    <div id="bmiIconContainer" class="mb-4 flex justify-center text-6xl icon-pop">
                        <!-- Ikon dimasukkan oleh JS -->
                    </div>
                    <div class="text-center">
                        <p class="text-xs font-bold text-blue-600 uppercase">BMI ANDA</p>
                        <h3 id="bmiValue" class="text-4xl font-black text-gray-800">--.-</h3>
                        <p id="bmiStatus" class="text-sm font-bold mt-1">--</p>
                    </div>

                    <!-- Panduan Pemakanan Peribadi -->
                    <div id="personalizedAdvice" class="mt-6 p-4 bg-white rounded-lg border border-blue-200 shadow-sm animate-fade-in">
                        <p class="text-xs font-bold text-blue-800 uppercase mb-2 flex items-center">
                            <i class="fa-solid fa-lightbulb mr-2 text-yellow-500"></i> Panduan Makan Anda:
                        </p>
                        <p id="adviceText" class="text-sm text-gray-700 leading-relaxed italic">
                            Sila buat timbangan untuk melihat panduan khusus.
                        </p>
                    </div>
                </div>

                <button type="submit" id="btnHantar" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl shadow-md transition-all flex justify-center items-center gap-2">
                    <i class="fa-solid fa-paper-plane"></i>
                    <span>HANTAR UNTUK REKOD</span>
                </button>
            </form>

            <!-- Kandungan Pendidikan Umum -->
            <div class="mt-8 pt-8 border-t border-gray-100">
                <h3 class="text-md font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fa-solid fa-plate-wheat mr-2 text-orange-500"></i> Asas Suku-Suku Separuh
                </h3>
                <div class="bg-orange-50 p-4 rounded-xl border border-orange-100">
                    <ul class="text-xs text-gray-700 space-y-2">
                        <li class="flex items-start">
                            <span class="text-orange-500 mr-2 font-bold">1/4</span>
                            <span><strong>Karbohidrat:</strong> Nasi, Roti, Bijirin (Tenaga)</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-orange-500 mr-2 font-bold">1/4</span>
                            <span><strong>Protein:</strong> Ikan, Ayam, Daging, Kekacang (Otot)</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-orange-500 mr-2 font-bold">1/2</span>
                            <span><strong>Serat:</strong> Sayur & Buah (Penghadaman & Vitamin)</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Bahagian Admin Sahaja -->
            <div id="adminSection" class="hidden mt-6 pt-6 border-t border-gray-100 text-center">
                <div class="bg-gray-50 p-4 rounded-lg border border-dashed border-gray-300">
                    <p class="text-[10px] font-bold text-gray-400 uppercase mb-2">Panel Admin Sahaja</p>
                    <a href="https://docs.google.com/spreadsheets/d/1fVpq-brUT7oYhJApRttj760fNJXOo1W3xw9RMKKPwQA/edit?usp=sharing" target="_blank" class="text-blue-600 text-sm font-bold hover:underline">
                        <i class="fa-solid fa-table mr-1"></i> Lihat Data Keseluruhan (Google Sheet)
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifikasi Toast -->
    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-full shadow-2xl opacity-0 transition-opacity duration-300 pointer-events-none z-50 text-center">
        <span id="toastMsg">Berjaya</span>
    </div>

    <script>
        // Google Apps Script URL
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxhFdtj2c_L91xfQ6JYvK3noY24Fty91JL3HgJyIKbUHVyLMff7H8EQqke7PpBDZpZ1VA/exec";

        let currentUser = null;

        // Permulaan
        window.onload = () => {
            document.getElementById('inputDate').valueAsDate = new Date();
            const savedUser = localStorage.getItem('jtm_user_basic');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMain();
            }
        };

        // Logik Log Masuk
        document.getElementById('loginForm').onsubmit = (e) => {
            e.preventDefault();
            const name = document.getElementById('loginName').value.trim();
            const dept = document.getElementById('loginDept').value;
            
            currentUser = { name, dept };
            localStorage.setItem('jtm_user_basic', JSON.stringify(currentUser));
            showMain();
        };

        function showMain() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainPage').classList.remove('hidden');
            document.getElementById('userInfo').textContent = `${currentUser.name} | ${currentUser.dept}`;

            const adminSection = document.getElementById('adminSection');
            if (currentUser.name.toLowerCase() === 'admin') {
                adminSection.classList.remove('hidden');
            } else {
                adminSection.classList.add('hidden');
            }
        }

        function logout() {
            if (confirm("Log keluar?")) {
                localStorage.removeItem('jtm_user_basic');
                location.reload();
            }
        }

        // Pengiraan & Penghantaran
        document.getElementById('timbanganForm').onsubmit = async (e) => {
            e.preventDefault();
            
            const weight = parseFloat(document.getElementById('inputWeight').value);
            const height = parseFloat(document.getElementById('inputHeight').value);
            const date = document.getElementById('inputDate').value;
            
            // Kira BMI
            const bmi = (weight / ((height/100) * (height/100))).toFixed(1);
            let status = "";
            let colorClass = "";
            let iconClass = "";
            let animClass = "";
            let advice = "";

            if(bmi < 18.5) { 
                status = "KURANG BERAT (Udang Kering)"; 
                colorClass = "text-blue-600"; 
                iconClass = "fa-solid fa-shrimp"; 
                animClass = "fa-beat text-blue-400";
                advice = "Anda perlu tingkatkan kalori berkhasiat! Tambah 'extra' protein dan lemak sihat seperti kacang dan avokado. Makan 5-6 kali sehari dalam hidangan kecil.";
            }
            else if(bmi < 25) { 
                status = "NORMAL (Mantap Boss)"; 
                colorClass = "text-green-600"; 
                iconClass = "fa-solid fa-face-grin-stars"; 
                animClass = "fa-bounce text-green-500";
                advice = "Hebat! Kekalkan momentum ini. Pastikan pilihan lauk yang pelbagai dan kurangkan garam dalam masakan.";
            }
            else if(bmi < 30) { 
                status = "LEBIH BERAT (Sikit Lagi)"; 
                colorClass = "text-yellow-600"; 
                iconClass = "fa-solid fa-cookie-bite"; 
                animClass = "fa-shake text-yellow-500";
                advice = "Fokus pada 'Separuh Pinggan' sayuran. Kurangkan minuman manis di kantin dan mulakan aktiviti berjalan 10k langkah sehari.";
            }
            else { 
                status = "OBESITI (Alamak!)"; 
                colorClass = "text-red-600"; 
                iconClass = "fa-solid fa-face-dizzy"; 
                animClass = "fa-spin fa-spin-reverse text-red-500";
                advice = "Jangan putus asa! Elakkan makanan diproses dan kurangkan nasi putih secara berperingkat.";
            }

            // Kemaskini Paparan Keputusan
            document.getElementById('bmiIconContainer').innerHTML = `<i class="${iconClass} ${animClass}"></i>`;
            document.getElementById('bmiValue').textContent = bmi;
            document.getElementById('bmiStatus').textContent = status;
            document.getElementById('bmiStatus').className = `text-sm font-bold mt-1 ${colorClass}`;
            document.getElementById('adviceText').textContent = advice;
            document.getElementById('resultBox').classList.remove('hidden');

            // Tetapkan semula animasi pop
            const iconContainer = document.getElementById('bmiIconContainer');
            iconContainer.classList.remove('icon-pop');
            void iconContainer.offsetWidth; 
            iconContainer.classList.add('icon-pop');

            // Hantar ke Google Sheet
            const btn = document.getElementById('btnHantar');
            const orgText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> Menghantar...`;

            const payload = {
                name: currentUser.name,
                dept: currentUser.dept,
                date: date,
                weight: weight,
                height: height,
                bmi: bmi,
                status: status
            };

            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                showToast("✅ Berjaya hantar untuk rekod!");
            } catch (error) {
                showToast("❌ Ralat penghantaran. Cuba lagi.");
            } finally {
                btn.disabled = false;
                btn.innerHTML = orgText;
            }
        };

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toastMsg').textContent = msg;
            t.classList.remove('opacity-0');
            setTimeout(() => t.classList.add('opacity-0'), 3000);
        }
    </script>
</body>
</html>
