<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fat to Fit JTM - Basic</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome for Icons (v6.4.0) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* Slate-100 */
            min-height: 100vh;
        }

        .jtm-blue {
            background-color: #1e3a8a;
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Animasi tersuai untuk keputusan */
        .icon-pop {
            animation: pop 0.5s cubic-bezier(0.26, 0.53, 0.74, 1.48) forwards;
        }

        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Container untuk Header Image */
        .header-container {
            width: 100%;
            height: 220px;
            overflow: hidden;
            position: relative;
            background-color: #1e3a8a; /* Warna simpanan jika imej gagal dimuat */
            border-bottom: 4px solid #facc15; /* Border kuning JTM */
        }

        .header-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        @media (max-width: 640px) {
            .header-container {
                height: 160px;
            }
        }
    </style>
</head>
<body class="text-gray-800 flex flex-col items-center py-8 px-4">

    <!-- 1. HALAMAN: LOG MASUK -->
    <div id="loginPage" class="w-full max-w-md bg-white rounded-3xl shadow-2xl overflow-hidden animate-fade-in">
        <!-- Header Image for Login -->
        <div class="header-container">
            <!-- Sila pastikan fail imej 'Gemini_Generated_Image_7er86x7er86x7er8.jpg' berada dalam folder yang sama -->
            <img src="Gemini_Generated_Image_7er86x7er86x7er8.jpg" 
                 alt="Header Cabaran JTM" 
                 onerror="this.src='https://images.unsplash.com/photo-1517836357463-d25dfeac3438?auto=format&fit=crop&w=800&q=80';">
        </div>
        
        <div class="p-8">
            <div class="text-center mb-8">
                <!-- Tukar kepada Log Masuk sahaja mengikut permintaan user -->
                <h2 class="text-2xl font-bold text-gray-800">Log Masuk</h2>
                <p class="text-sm text-gray-500 mt-2 italic font-medium">"Langkah Ke Arah Hidup Lebih Sihat"</p>
            </div>
            
            <form id="loginForm" class="space-y-5">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Nama Penuh</label>
                    <input type="text" id="loginName" required placeholder="Cth: Ahmad bin Abu" class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-600 outline-none transition-all">
                    <p class="text-[10px] text-gray-400 mt-1">* Log masuk sebagai 'Admin' untuk akses data keseluruhan.</p>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Bahagian</label>
                    <select id="loginDept" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-600 outline-none bg-white transition-all">
                        <option value="">Pilih Bahagian...</option>
                        <option value="PENGURUSAN TERTINGGI">PENGURUSAN TERTINGGI</option>
                        <option value="BAHAGIAN KHIDMAT PENGURUSAN">BAHAGIAN KHIDMAT PENGURUSAN</option>
                        <option value="BAHAGIAN PEMBANGUNAN KEMAHIRAN">BAHAGIAN PEMBANGUNAN KEMAHIRAN</option>
                        <option value="BAHAGIAN KAWALAN TEKNIKAL">BAHAGIAN KAWALAN TEKNIKAL</option>
                        <option value="BAHAGIAN PENGURUSAN LATIHAN">BAHAGIAN PENGURUSAN LATIHAN</option>
                        <option value="BAHAGIAN PERANCANGAN & PENYELIDIKAN">BAHAGIAN PERANCANGAN & PENYELIDIKAN</option>
                        <option value="UNIT JALINAN INDUSTRI">UNIT JALINAN INDUSTRI</option>
                    </select>
                </div>
                <button type="submit" class="w-full jtm-blue hover:bg-blue-800 text-white font-bold py-4 rounded-xl shadow-lg transform active:scale-95 transition-all flex items-center justify-center gap-2">
                    MASUK KE CABARAN <i class="fa-solid fa-fire text-orange-400"></i>
                </button>
            </form>
        </div>
    </div>

    <!-- 2. HALAMAN: TIMBANGAN & HANTAR -->
    <div id="mainPage" class="hidden w-full max-w-lg bg-white rounded-3xl shadow-2xl overflow-hidden animate-fade-in my-4">
        <!-- Header Image for Main Page -->
        <div class="header-container relative">
            <img src="Gemini_Generated_Image_7er86x7er86x7er8.jpg" 
                 alt="Header Cabaran JTM" 
                 onerror="this.src='https://images.unsplash.com/photo-1526506118085-60ce8714f8c5?auto=format&fit=crop&w=800&q=80';">
            <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex items-end p-6">
                <div class="text-white">
                    <h1 class="font-bold text-xl flex items-center gap-2 drop-shadow-md">
                        <i class="fa-solid fa-dumbbell"></i> FAT TO FIT JTM
                    </h1>
                    <p id="userInfo" class="text-xs opacity-90 drop-shadow-sm font-medium">Nama Pegawai | Bahagian</p>
                </div>
            </div>
            <button onclick="logout()" class="absolute top-4 right-4 bg-black/30 hover:bg-black/50 text-white w-10 h-10 rounded-full backdrop-blur-sm transition-all flex items-center justify-center border border-white/20">
                <i class="fa-solid fa-power-off text-lg"></i>
            </button>
        </div>

        <!-- Borang Timbangan -->
        <div class="p-8">
            <form id="timbanganForm" class="space-y-6">
                <div class="grid grid-cols-2 gap-4">
                    <div class="col-span-2">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Tarikh Timbangan</label>
                        <input type="date" id="inputDate" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Berat (kg)</label>
                        <input type="number" id="inputWeight" step="0.1" placeholder="0.0" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Tinggi (cm)</label>
                        <input type="number" id="inputHeight" step="1" placeholder="0" required class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                </div>

                <!-- Kawasan Keputusan -->
                <div id="resultBox" class="hidden p-6 bg-blue-50 border border-blue-100 rounded-2xl shadow-inner">
                    <div id="bmiIconContainer" class="mb-4 flex justify-center text-6xl icon-pop">
                        <!-- Ikon dimasukkan oleh JS -->
                    </div>
                    <div class="text-center">
                        <p class="text-xs font-bold text-blue-600 uppercase tracking-widest">BMI ANDA</p>
                        <h3 id="bmiValue" class="text-5xl font-black text-gray-800">--.-</h3>
                        <p id="bmiStatus" class="text-sm font-bold mt-2 px-4 py-1 rounded-full inline-block">--</p>
                    </div>

                    <!-- Panduan Pemakanan Peribadi -->
                    <div id="personalizedAdvice" class="mt-6 p-4 bg-white rounded-xl border border-blue-200 shadow-sm animate-fade-in">
                        <p class="text-xs font-bold text-blue-800 uppercase mb-2 flex items-center">
                            <i class="fa-solid fa-lightbulb mr-2 text-yellow-500"></i> Panduan Makan Anda:
                        </p>
                        <p id="adviceText" class="text-sm text-gray-700 leading-relaxed italic">
                            Sila buat timbangan untuk melihat panduan khusus.
                        </p>
                    </div>
                </div>

                <button type="submit" id="btnHantar" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl shadow-md transition-all flex items-center justify-center gap-2 transform active:scale-95">
                    <i class="fa-solid fa-paper-plane"></i>
                    <span>HANTAR UNTUK REKOD</span>
                </button>
            </form>

            <!-- Kandungan Pendidikan -->
            <div class="mt-8 pt-8 border-t border-gray-100 text-center">
                <p class="text-xs text-gray-400 uppercase font-bold tracking-widest mb-4">Tips Kesihatan</p>
                <div class="grid grid-cols-3 gap-2">
                    <div class="p-2 bg-blue-50 rounded-lg">
                        <i class="fa-solid fa-water text-blue-500 mb-1"></i>
                        <p class="text-[9px] font-bold">MINUM AIR</p>
                    </div>
                    <div class="p-2 bg-green-50 rounded-lg">
                        <i class="fa-solid fa-leaf text-green-500 mb-1"></i>
                        <p class="text-[9px] font-bold">LEBIH SAYUR</p>
                    </div>
                    <div class="p-2 bg-orange-50 rounded-lg">
                        <i class="fa-solid fa-person-walking text-orange-500 mb-1"></i>
                        <p class="text-[9px] font-bold">10K LANGKAH</p>
                    </div>
                </div>
            </div>

            <!-- Panel Admin -->
            <div id="adminSection" class="hidden mt-6 pt-6 border-t border-gray-100 text-center">
                <div class="bg-gray-100 p-4 rounded-xl border border-dashed border-gray-400">
                    <p class="text-[10px] font-bold text-gray-500 uppercase mb-2">Panel Admin Sahaja</p>
                    <a href="https://docs.google.com/spreadsheets/d/1fVpq-brUT7oYhJApRttj760fNJXOo1W3xw9RMKKPwQA/edit?usp=sharing" target="_blank" class="text-blue-700 text-sm font-bold hover:underline flex items-center justify-center gap-2">
                        <i class="fa-solid fa-table"></i> Lihat Data Keseluruhan (Sheet)
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifikasi Toast -->
    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-8 py-4 rounded-full shadow-2xl opacity-0 transition-opacity duration-300 pointer-events-none z-50 text-center font-semibold">
        <span id="toastMsg">Berjaya</span>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxhFdtj2c_L91xfQ6JYvK3noY24Fty91JL3HgJyIKbUHVyLMff7H8EQqke7PpBDZpZ1VA/exec";
        let currentUser = null;

        window.onload = () => {
            document.getElementById('inputDate').valueAsDate = new Date();
            const savedUser = localStorage.getItem('jtm_user_basic');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMain();
            }
        };

        document.getElementById('loginForm').onsubmit = (e) => {
            e.preventDefault();
            const name = document.getElementById('loginName').value.trim();
            const dept = document.getElementById('loginDept').value;
            currentUser = { name, dept };
            localStorage.setItem('jtm_user_basic', JSON.stringify(currentUser));
            showMain();
        };

        function showMain() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainPage').classList.remove('hidden');
            document.getElementById('userInfo').textContent = `${currentUser.name} | ${currentUser.dept}`;
            const adminSection = document.getElementById('adminSection');
            if (currentUser.name.toLowerCase() === 'admin') {
                adminSection.classList.remove('hidden');
            } else {
                adminSection.classList.add('hidden');
            }
        }

        function logout() {
            if (confirm("Log keluar?")) {
                localStorage.removeItem('jtm_user_basic');
                location.reload();
            }
        }

        document.getElementById('timbanganForm').onsubmit = async (e) => {
            e.preventDefault();
            const weight = parseFloat(document.getElementById('inputWeight').value);
            const height = parseFloat(document.getElementById('inputHeight').value);
            const date = document.getElementById('inputDate').value;
            const bmi = (weight / ((height/100) * (height/100))).toFixed(1);
            
            let status = "", colorClass = "", bgStatusClass = "", iconClass = "", animClass = "", advice = "";

            if(bmi < 18.5) { 
                status = "KURANG BERAT (Udang Kering)"; 
                colorClass = "text-blue-600"; bgStatusClass = "bg-blue-100 text-blue-700";
                iconClass = "fa-solid fa-shrimp"; animClass = "fa-beat text-blue-400";
                advice = "Tingkatkan kalori berkhasiat! Tambah protein dan lemak sihat.";
            } else if(bmi < 25) { 
                status = "NORMAL (Mantap Boss)"; 
                colorClass = "text-green-600"; bgStatusClass = "bg-green-100 text-green-700";
                iconClass = "fa-solid fa-face-grin-stars"; animClass = "fa-bounce text-green-500";
                advice = "Hebat! Kekalkan momentum ini dengan pemakanan seimbang.";
            } else if(bmi < 30) { 
                status = "LEBIH BERAT (Sikit Lagi)"; 
                colorClass = "text-yellow-600"; bgStatusClass = "bg-yellow-100 text-yellow-700";
                iconClass = "fa-solid fa-cookie-bite"; animClass = "fa-shake text-yellow-500";
                advice = "Fokus pada sayuran. Kurangkan minuman manis.";
            } else { 
                status = "OBESITI (Alamak!)"; 
                colorClass = "text-red-600"; bgStatusClass = "bg-red-100 text-red-700";
                iconClass = "fa-solid fa-face-dizzy"; animClass = "fa-spin fa-spin-reverse text-red-500";
                advice = "Jangan putus asa! Kurangkan nasi putih dan makanan diproses.";
            }

            document.getElementById('bmiIconContainer').innerHTML = `<i class="${iconClass} ${animClass}"></i>`;
            document.getElementById('bmiValue').textContent = bmi;
            document.getElementById('bmiStatus').textContent = status;
            document.getElementById('bmiStatus').className = `text-sm font-bold mt-2 px-4 py-1 rounded-full inline-block ${bgStatusClass}`;
            document.getElementById('adviceText').textContent = advice;
            document.getElementById('resultBox').classList.remove('hidden');

            const iconContainer = document.getElementById('bmiIconContainer');
            iconContainer.classList.remove('icon-pop');
            void iconContainer.offsetWidth; 
            iconContainer.classList.add('icon-pop');

            const btn = document.getElementById('btnHantar');
            const orgText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> MENYIMPAN...`;

            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST', mode: 'no-cors', cache: 'no-cache',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: currentUser.name, dept: currentUser.dept, date, weight, height, bmi, status })
                });
                showToast("✅ Berjaya hantar untuk rekod!");
            } catch (error) {
                showToast("❌ Ralat penghantaran. Cuba lagi.");
            } finally {
                btn.disabled = false;
                btn.innerHTML = orgText;
            }
        };

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toastMsg').textContent = msg;
            t.classList.remove('opacity-0');
            setTimeout(() => t.classList.add('opacity-0'), 3000);
        }
    </script>
</body>
</html>
