<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fat to Fit JTM - Basic</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome for Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .jtm-blue {
            background-color: #1e3a8a;
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="text-gray-800 min-h-screen flex items-center justify-center p-4">

    <!-- 1. PAGE: LOG IN -->
    <div id="loginPage" class="w-full max-w-md bg-white rounded-2xl shadow-xl p-8 animate-fade-in">
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-blue-100 mb-4 text-blue-800">
                <i class="fa-solid fa-user-circle text-4xl"></i>
            </div>
            <h2 class="text-2xl font-bold text-gray-800">Log Masuk Pegawai</h2>
            <p class="text-sm text-gray-500 mt-2">Sila kenal pasti diri anda untuk memulakan timbangan.</p>
        </div>
        
        <form id="loginForm" class="space-y-5">
            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Nama Penuh</label>
                <input type="text" id="loginName" required placeholder="Cth: Ahmad bin Abu" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-600 outline-none transition-all">
                <p class="text-[10px] text-gray-400 mt-1">* Log masuk sebagai 'Admin' untuk akses data keseluruhan.</p>
            </div>
            <div>
                <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Bahagian</label>
                <select id="loginDept" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-600 outline-none bg-white transition-all">
                    <option value="">Pilih Bahagian...</option>
                    <option value="PENGURUSAN TERTINGGI">PENGURUSAN TERTINGGI</option>
                    <option value="BAHAGIAN KHIDMAT PENGURUSAN">BAHAGIAN KHIDMAT PENGURUSAN</option>
                    <option value="BAHAGIAN PEMBANGUNAN KEMAHIRAN">BAHAGIAN PEMBANGUNAN KEMAHIRAN</option>
                    <option value="BAHAGIAN KAWALAN TEKNIKAL">BAHAGIAN KAWALAN TEKNIKAL</option>
                    <option value="BAHAGIAN PENGURUSAN LATIHAN">BAHAGIAN PENGURUSAN LATIHAN</option>
                    <option value="BAHAGIAN PERANCANGAN & PENYELIDIKAN">BAHAGIAN PERANCANGAN & PENYELIDIKAN</option>
                    <option value="UNIT JALINAN INDUSTRI">UNIT JALINAN INDUSTRI</option>
                </select>
            </div>
            <button type="submit" class="w-full jtm-blue hover:bg-blue-800 text-white font-bold py-3 rounded-lg shadow-lg transform active:scale-95 transition-all">
                Masuk <i class="fa-solid fa-arrow-right ml-2"></i>
            </button>
        </form>
    </div>

    <!-- 2. PAGE: TIMBANGAN & HANTAR -->
    <div id="mainPage" class="hidden w-full max-w-lg bg-white rounded-2xl shadow-xl overflow-hidden animate-fade-in my-8">
        <!-- Header -->
        <div class="jtm-blue p-6 text-white flex justify-between items-center">
            <div>
                <h1 class="font-bold text-xl">Fat to Fit JTM</h1>
                <p id="userInfo" class="text-xs text-blue-200">Nama Pegawai | Bahagian</p>
            </div>
            <button onclick="logout()" class="text-white opacity-70 hover:opacity-100">
                <i class="fa-solid fa-power-off text-lg"></i>
            </button>
        </div>

        <!-- Form Timbangan -->
        <div class="p-8">
            <form id="timbanganForm" class="space-y-6">
                <div class="grid grid-cols-2 gap-4">
                    <div class="col-span-2">
                        <label class="block text-sm font-bold text-gray-700 mb-2">Tarikh</label>
                        <input type="date" id="inputDate" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-600 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Berat (kg)</label>
                        <input type="number" id="inputWeight" step="0.1" placeholder="0.0" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-600 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">Tinggi (cm)</label>
                        <input type="number" id="inputHeight" step="1" placeholder="0" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-600 outline-none">
                    </div>
                </div>

                <!-- Result Area -->
                <div id="resultBox" class="hidden p-4 bg-blue-50 border border-blue-100 rounded-xl text-center">
                    <p class="text-xs font-bold text-blue-600 uppercase">BMI ANDA</p>
                    <h3 id="bmiValue" class="text-4xl font-black text-gray-800">--.-</h3>
                    <p id="bmiStatus" class="text-sm font-bold mt-1">--</p>
                </div>

                <button type="submit" id="btnHantar" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl shadow-md transition-all flex justify-center items-center gap-2">
                    <i class="fa-solid fa-paper-plane"></i>
                    <span>HANTAR KE GOOGLE SHEET</span>
                </button>
            </form>

            <!-- Bahagian Panduan Pemakanan Seimbang (Baru Ditambah) -->
            <div class="mt-8 pt-8 border-t border-gray-100">
                <h3 class="text-md font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fa-solid fa-utensils mr-2 text-orange-500"></i> Panduan Pemakanan Seimbang
                </h3>
                <div class="space-y-4">
                    <div class="bg-orange-50 p-4 rounded-xl border border-orange-100">
                        <p class="text-xs font-bold text-orange-700 uppercase mb-2">Konsep Suku-Suku Separuh</p>
                        <ul class="text-sm text-gray-700 space-y-2">
                            <li class="flex items-start">
                                <span class="text-orange-500 mr-2">●</span>
                                <span><strong>Suku Pinggan:</strong> Karbohidrat (Nasi, Roti, Bijirin)</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-orange-500 mr-2">●</span>
                                <span><strong>Suku Pinggan:</strong> Protein (Ikan, Ayam, Daging, Kekacang)</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-orange-500 mr-2">●</span>
                                <span><strong>Separuh Pinggan:</strong> Sayur-sayuran dan Buah-buahan</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 text-[11px]">
                        <div class="bg-blue-50 p-3 rounded-lg border border-blue-100 flex items-center">
                            <i class="fa-solid fa-droplet text-blue-500 mr-2"></i> Minum 8 gelas air sehari
                        </div>
                        <div class="bg-red-50 p-3 rounded-lg border border-red-100 flex items-center">
                            <i class="fa-solid fa-ban text-red-500 mr-2"></i> Kurangkan gula & garam
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Section Only -->
            <div id="adminSection" class="hidden mt-6 pt-6 border-t border-gray-100 text-center">
                <div class="bg-gray-50 p-4 rounded-lg border border-dashed border-gray-300">
                    <p class="text-[10px] font-bold text-gray-400 uppercase mb-2">Panel Admin Sahaja</p>
                    <a href="https://docs.google.com/spreadsheets/d/1fVpq-brUT7oYhJApRttj760fNJXOo1W3xw9RMKKPwQA/edit?usp=sharing" target="_blank" class="text-blue-600 text-sm font-bold hover:underline">
                        <i class="fa-solid fa-table mr-1"></i> Lihat Data Keseluruhan (Google Sheet)
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-full shadow-2xl opacity-0 transition-opacity duration-300 pointer-events-none z-50">
        <span id="toastMsg">Berjaya</span>
    </div>

    <script>
        // Google Apps Script URL
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxhFdtj2c_L91xfQ6JYvK3noY24Fty91JL3HgJyIKbUHVyLMff7H8EQqke7PpBDZpZ1VA/exec";

        let currentUser = null;

        // Init
        window.onload = () => {
            document.getElementById('inputDate').valueAsDate = new Date();
            const savedUser = localStorage.getItem('jtm_user_basic');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMain();
            }
        };

        // Login Logic
        document.getElementById('loginForm').onsubmit = (e) => {
            e.preventDefault();
            const name = document.getElementById('loginName').value.trim();
            const dept = document.getElementById('loginDept').value;
            
            currentUser = { name, dept };
            localStorage.setItem('jtm_user_basic', JSON.stringify(currentUser));
            showMain();
        };

        function showMain() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainPage').classList.remove('hidden');
            document.getElementById('userInfo').textContent = `${currentUser.name} | ${currentUser.dept}`;

            // Admin Access Check
            const adminSection = document.getElementById('adminSection');
            if (currentUser.name.toLowerCase() === 'admin') {
                adminSection.classList.remove('hidden');
            } else {
                adminSection.classList.add('hidden');
            }
        }

        function logout() {
            if (confirm("Log keluar?")) {
                localStorage.removeItem('jtm_user_basic');
                location.reload();
            }
        }

        // Calculation & Submission
        document.getElementById('timbanganForm').onsubmit = async (e) => {
            e.preventDefault();
            
            const weight = parseFloat(document.getElementById('inputWeight').value);
            const height = parseFloat(document.getElementById('inputHeight').value);
            const date = document.getElementById('inputDate').value;
            
            // Calc BMI
            const bmi = (weight / ((height/100) * (height/100))).toFixed(1);
            let status = "";
            let color = "";

            if(bmi < 18.5) { status = "KURANG BERAT"; color = "text-blue-600"; }
            else if(bmi < 25) { status = "NORMAL"; color = "text-green-600"; }
            else if(bmi < 30) { status = "LEBIH BERAT"; color = "text-yellow-600"; }
            else { status = "OBESITI"; color = "text-red-600"; }

            // Update UI Result
            document.getElementById('bmiValue').textContent = bmi;
            document.getElementById('bmiStatus').textContent = status;
            document.getElementById('bmiStatus').className = `text-sm font-bold mt-1 ${color}`;
            document.getElementById('resultBox').classList.remove('hidden');

            // Send to Google Sheet
            const btn = document.getElementById('btnHantar');
            const orgText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> Menghantar...`;

            const payload = {
                name: currentUser.name,
                dept: currentUser.dept,
                date: date,
                weight: weight,
                height: height,
                bmi: bmi,
                status: status
            };

            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                showToast("✅ Berjaya hantar ke Google Sheet!");
            } catch (error) {
                showToast("❌ Ralat penghantaran. Cuba lagi.");
            } finally {
                btn.disabled = false;
                btn.innerHTML = orgText;
            }
        };

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toastMsg').textContent = msg;
            t.classList.remove('opacity-0');
            setTimeout(() => t.classList.add('opacity-0'), 3000);
        }
    </script>
</body>
</html>
